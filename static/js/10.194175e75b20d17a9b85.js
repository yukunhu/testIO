webpackJsonp([10],{"2avj":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=c(a("aA9S")),o=c(a("4YfN")),i=a("R4Sj"),n=a("VSB1"),r=a("ZgZx");function c(t){return t&&t.__esModule?t:{default:t}}e.default={name:"subAccount",data:function(){var t=this;return{account:this.$store.state.app.userInfo.userAccount,formData:{account:this.$store.state.app.userInfo.userAccount,telephone:"",name:"",current:1,rowCount:10},tableListData:[],loading:!1,pager:{total:0,Opts:[10,20,30,50]},columns:[{title:"序号",width:66,align:"left",fixed:"left",render:function(e,a){return e("span",a.index+(t.formData.current-1)*t.formData.rowCount+1)}},{title:"操作",width:120,key:"action",align:"left",fixed:"left",render:function(e,a){var s=[],o=e("span",{style:{margin:"0 10px",color:"#D8D8D8 "}},"|"),i=e("a",{on:{click:function(){t.switchStatus(a.row)}}},"1"===a.row.state?"启用":"0"===a.row.state?"禁用":"无"),n=e("a",{on:{click:function(){t.edit(a.row)}}},"修改");return s.push(i,o,n),e("div",s)}},{title:"用户账号",key:"subAccount"},{title:"用户姓名",key:"name"},{title:"手机号",key:"telephone"},{title:"状态",key:"state",render:function(t,e){var a=e.row;return t("span","0"===a.state?"正常":"1"===a.state?"禁用":"无")}}],editFlag:!1,showAddSubAccountModel:!1,addSubAccountTitleModel:"",phoneTailNumber:"",smsSendTiming:!1,sendSmsSuccessFlag:!1,auth_time:0,confirmLoading:!1,showResModal:!1,infoSave:{},editFormData:{account:this.$store.state.app.userInfo.userAccount,subAccount:"",name:"",password:"",telephone:"",verificationCode:"",sex:""},ruleValidate:{password:[{validator:function(e,a,s){n.yx.isEmpty(a)?!0===t.editFlag?s():s(new Error("密码不能为空")):s()},trigger:"change"}],name:[{required:!0,message:"用户姓名不能为空",trigger:"change"}],telephone:[(0,r.required)("手机号"),{validator:r.validators.mobile,trigger:"change"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}],verificationCode:[{required:!0,message:"验证码不能为空",trigger:"change"}]}}},computed:{smsSendBtnDisabled:function(){return this.smsSendTiming||this.confirmLoading||!/^1[3|4|5|6|7|8|9]\d{9}$/.test(this.editFormData.telephone)}},methods:(0,o.default)({},(0,i.mapMutations)("app",["showLoading","hideLoading"]),{errorModal:function(t,e,a){var s=this,o="";t.split(";").forEach(function(t){t&&(o+=o?"；<br>"+t:t)});var i={title:"提示",okText:a||"确 定",content:o};e&&(i.onOk=e);var n=setTimeout(function(){s.$Modal.error(i),clearTimeout(n)},300)},fnReset:function(t){this.$refs[t].resetFields(),this.queryList()},querySubAccountList:function(){(0,s.default)({},this.formData);this.formData.current=1,this.queryList()},saveToList:function(){var t=this;this.confirmLoading=!0,this.showResModal=!1;var e=setTimeout(function(){t.confirmLoading=!1,clearTimeout(e)},1e3);this.queryList()},addSubAccount:function(){this.$refs.editFormData.resetFields(),this.addSubAccountTitleModel="新增子账号",this.showAddSubAccountModel=!0,this.sendSmsSuccessFlag=!1,this.auth_time=0,this.editFlag=!1},edit:function(t){this.$refs.editFormData.resetFields(),this.addSubAccountTitleModel="修改账号信息",this.showAddSubAccountModel=!0,this.sendSmsSuccessFlag=!1,this.auth_time=0,this.editFlag=!0,this.editFormData=(0,s.default)({},t)},pageChange:function(t){this.formData.current=t,this.queryList()},pageSizeChange:function(t){this.formData.current=1,this.formData.rowCount=t,this.queryList()},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;if(e.confirmLoading=!0,e.editFlag){var a=(0,s.default)({},e.editFormData);a.account=e.account,e.showLoading(),e.$http.post(polarisserver+"/subaccount/update",a).then(function(t){e.hideLoading(),e.confirmLoading=!1;var a=t.data;if(!a.success)return e.errorModal(a.errorMessage||"修改子帐号请求失败");e.$Message.success("修改成功"),e.showAddSubAccountModel=!1,e.queryList()}).catch(function(t){e.hideLoading(),e.confirmLoading=!1,e.errorCatchModal("修改子账号请求出错：",t)})}else{var o=(0,s.default)({},e.editFormData);o.account=e.account,e.showLoading(),e.$http.post(polarisserver+"/subaccount/add",o).then(function(t){e.hideLoading(),e.confirmLoading=!1;var a=t.data;if(!a.success)return e.errorModal(a.errorMessage||"新增子帐号请求失败");e.$Message.success("新增成功"),e.showAddSubAccountModel=!1,e.showResModal=!0,e.infoSave=a.data||{}}).catch(function(t){e.hideLoading(),e.confirmLoading=!1,e.errorCatchModal("新增子账号请求出错：",t)})}})},handleReset:function(t){this.showAddSubAccountModel=!1,this.$refs[t].resetFields()},switchStatus:function(t){var e=this,a={account:this.account,subAccount:t.subAccount,state:"1"===t.state?"0":"1"},s="",o="";"1"===t.state?(s="<p>启用后，"+t.subAccount+"账号将开启进件，是否确认开启？</p>",o="启用"):(s="<p>禁用后，"+t.subAccount+"账号将不能登录，确认是否禁用？</p>",o="禁用"),this.$Modal.confirm({title:"提 示",content:s,onOk:function(){e.showLoading(),e.$http.post(polarisserver+"/subaccount/disable",a).then(function(t){e.hideLoading();var a=t.data;if(!a.success)return e.errorModal(a.errorMessage||"帐号"+o+"请求失败");e.queryList()}).catch(function(t){e.hideLoading(),e.errorCatchModal("帐号"+o+"请求出错：",t)})}})},queryList:function(){var t=this;if(this.loading)return!1;this.tableListData=[],this.loading=!0,this.showLoading();var e=(0,s.default)({},this.formData);this.$http.post(polarisserver+"/subaccount/query",e).then(function(e){t.hideLoading(),t.loading=!1;var a=e.data;if(!a.success)return t.errorModal(a.errorMessage||"帐号列表查询请求失败");var s=a.data||{};t.pager.total=s.total,t.tableListData=s.data||[]}).catch(function(e){t.hideLoading(),t.loading=!1,t.errorCatchModal("帐号列表查询请求出错：",e)})},sendVerificationCode:function(){var t=this;this.phoneTailNumber="",this.auth_time=60,this.smsSendTiming=!0;var e=setInterval(function(){t.auth_time--,t.auth_time<=0&&(t.smsSendTiming=!1,clearInterval(e))},1e3),a={telephone:this.editFormData.telephone,extraMap:{account:this.account}};this.$http.post(polarisserver+"/subaccount/sendShortMessage",a).then(function(e){var a=e.data;if(!a.success)return t.errorModal(a.errorMessage||"发送验证码请求失败");t.phoneTailNumber=t.editFormData.telephone.substr(7),t.sendSmsSuccessFlag=!0}).catch(function(e){t.errorCatchModal("发送验证码请求出错：",e)})}}),mounted:function(){document.title="子帐号管理",this.queryList()}}},AyWs:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("2avj"),o=a.n(s);for(var i in s)"default"!==i&&function(t){a.d(e,t,function(){return s[t]})}(i);var n=a("JS+Q");var r=function(t){a("o+nX")},c=a("C7Lr")(o.a,n.a,!1,r,"data-v-05e59d93",null);e.default=c.exports},"JS+Q":function(t,e,a){"use strict";var s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"margin-20 subAccountManage"},[a("div",{staticClass:"cm-panel",staticStyle:{"padding-bottom":"10px"}},[a("i-form",{ref:"formData",attrs:{model:t.formData,"label-width":60}},[a("Row",[a("i-col",{attrs:{xs:24,sm:8,md:6}},[a("Form-item",{attrs:{label:"用户姓名",prop:"name"}},[a("i-input",{attrs:{type:"text",clearable:"",placeholder:"请输入"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),t._v(" "),a("i-col",{attrs:{xs:24,sm:8,md:6}},[a("Form-item",{attrs:{label:"手机号",prop:"telephone"}},[a("i-input",{attrs:{type:"text",clearable:"",placeholder:"请输入"},model:{value:t.formData.telephone,callback:function(e){t.$set(t.formData,"telephone",e)},expression:"formData.telephone"}})],1)],1),t._v(" "),a("i-col",{attrs:{xs:24,sm:8,md:6}},[a("div",{staticClass:"text-center font0"},[a("i-button",{on:{click:function(e){return t.fnReset("formData")}}},[t._v("重置")]),t._v(" "),a("i-button",{attrs:{type:"primary"},on:{click:t.querySubAccountList}},[t._v("查询")])],1)])],1)],1)],1),t._v(" "),a("div",{staticClass:"cm-panel"},[a("div",{staticClass:"text-right margin-b-10"},[a("i-button",{attrs:{type:"primary","custom-icon":"iconfont icon-add"},on:{click:t.addSubAccount}},[t._v("新增子账号")])],1),t._v(" "),a("i-table",{staticClass:"table-static-list",attrs:{border:"",columns:t.columns,data:t.tableListData}}),t._v(" "),a("Row",{staticClass:"margin-t-10"},[a("Page",{attrs:{total:t.pager.total,"page-size":t.formData.Page,current:t.formData.current,"page-size-opts":t.pager.Opts,size:"small","show-sizer":"","show-elevator":""},on:{"on-change":t.pageChange,"on-page-size-change":t.pageSizeChange}})],1)],1),t._v(" "),a("Modal",{staticClass:"showAddSubAccountModel",attrs:{"mask-closable":!1,"footer-hide":"",width:"374",title:t.addSubAccountTitleModel},model:{value:t.showAddSubAccountModel,callback:function(e){t.showAddSubAccountModel=e},expression:"showAddSubAccountModel"}},[a("Form",{ref:"editFormData",staticStyle:{"margin-top":"-10px"},attrs:{model:t.editFormData,rules:t.ruleValidate,"label-width":58}},[t.editFlag?a("FormItem",{attrs:{label:"用户账号"}},[a("span",{staticClass:"spanline32"},[t._v(t._s(t.editFormData.subAccount))])]):t._e(),t._v(" "),a("FormItem",{attrs:{label:"用户姓名",prop:"name"}},[a("Input",{attrs:{placeholder:"请输入"},model:{value:t.editFormData.name,callback:function(e){t.$set(t.editFormData,"name",e)},expression:"editFormData.name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"性别",prop:"sex"}},[a("RadioGroup",{model:{value:t.editFormData.sex,callback:function(e){t.$set(t.editFormData,"sex",e)},expression:"editFormData.sex"}},[a("Radio",{attrs:{label:"1"}},[t._v("男")]),t._v(" "),a("Radio",{attrs:{label:"0"}},[t._v("女")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"手机号码",prop:"telephone"}},[a("Input",{attrs:{placeholder:"请输入"},model:{value:t.editFormData.telephone,callback:function(e){t.$set(t.editFormData,"telephone",e)},expression:"editFormData.telephone"}})],1),t._v(" "),a("FormItem",{attrs:{label:"密码",prop:"password"}},[a("Input",{attrs:{type:"password",placeholder:"请输入"},model:{value:t.editFormData.password,callback:function(e){t.$set(t.editFormData,"password",e)},expression:"editFormData.password"}})],1),t._v(" "),a("FormItem",{attrs:{label:"验证码",prop:"verificationCode"}},[a("div",{staticClass:"font0"},[a("Input",{staticClass:"half-gutter-width",attrs:{placeholder:"请输入"},model:{value:t.editFormData.verificationCode,callback:function(e){t.$set(t.editFormData,"verificationCode",e)},expression:"editFormData.verificationCode"}}),t._v(" "),a("Button",{staticClass:"half-gutter-width margin-l-10 radius4",attrs:{type:"primary",disabled:t.smsSendBtnDisabled},on:{click:t.sendVerificationCode}},[t.smsSendTiming?a("span",[t._v("已发送("+t._s(t.auth_time)+"S)")]):a("span",[t._v("发送验证码")])])],1)]),t._v(" "),t.sendSmsSuccessFlag?a("div",{staticStyle:{"padding-left":"58px"}},[a("span",{staticClass:"sms-send-tip"},[t._v("验证码已发送至尾号"+t._s(t.phoneTailNumber)+"的手机上，请填写该手机收到的验证码")])]):t._e()],1),t._v(" "),a("div",{staticClass:"text-right margin-t-30 font0"},[a("Button",{on:{click:function(e){return t.handleReset("editFormData")}}},[t._v("取 消")]),t._v(" "),a("Button",{attrs:{type:"primary",loading:t.confirmLoading},on:{click:function(e){return t.handleSubmit("editFormData")}}},[t.confirmLoading?a("span",[t._v("请求中...")]):a("span",[t._v("确 定")])])],1)],1),t._v(" "),a("Modal",{attrs:{title:"提示信息","mask-closable":!1,"footer-hide":"",width:"374",closable:!1},model:{value:t.showResModal,callback:function(e){t.showResModal=e},expression:"showResModal"}},[a("Form",{staticClass:"form-readonly",attrs:{"label-width":58}},[a("FormItem",{attrs:{label:"子账号"}},[a("span",{staticClass:"spanline32"},[t._v(t._s(t.infoSave.subAccount))])]),t._v(" "),a("FormItem",{attrs:{label:"用户姓名"}},[a("span",{staticClass:"spanline32"},[t._v(t._s(t.infoSave.name))])]),t._v(" "),a("FormItem",{attrs:{label:"手机号"}},[a("span",{staticClass:"spanline32"},[t._v(t._s(t.infoSave.telephone))])]),t._v(" "),a("FormItem",{attrs:{label:"账户状态"}},[a("span",{staticClass:"spanline32"},[t._v("正常")])]),t._v(" "),a("FormItem",{attrs:{label:"性别"}},[a("span",{staticClass:"spanline32"},[t._v(t._s("1"===t.infoSave.sex?"男":"0"===t.infoSave.sex?"女":"无"))])])],1),t._v(" "),a("div",{staticClass:"text-right margin-t-20"},[a("i-button",{attrs:{type:"primary",loading:t.confirmLoading},on:{click:t.saveToList}},[t._v("确 定")])],1)],1),t._v(" "),a("div",{staticClass:"simple-breadcrumb col-xs-11"},[a("span",[t._v("销售管理")]),t._v(" "),a("Icon",{attrs:{type:"ios-arrow-forward"}}),t._v(" "),a("span",[t._v("子账号管理")])],1)],1)},staticRenderFns:[]};e.a=s},"o+nX":function(t,e){}});
//# sourceMappingURL=10.194175e75b20d17a9b85.js.map